<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>RTEMLib: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="cdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RTEMLib
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">RTEMLib Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#overview">Overview </a></li>
<li class="level1"><a href="#usagerteml">Usage of RTEMLib </a><ul><li class="level2"><a href="#istantiating">Instantiating buffers </a></li>
<li class="level2"><a href="#smonitor">Developing a simple Monitor </a><ul><li class="level3"><a href="#consumerp">Consumer procedure</a></li>
</ul>
</li>
<li class="level2"><a href="#producerp">Producer procedure for Monitors</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="overview"></a>
Overview </h1>
<p>RunTime Embedded Monitoring Library (RTEMLib) has been developed for runtime monitoring of real-time embedded systems. RTEMLib is based on lock-free ring buffer FIFO queues either for ARM and X86 platforms. This library is used to implement different monitoring architectures such as the ones proposed in <a href="http://link.springer.com/chapter/10.1007%2F978-3-319-19584-1_5">[1]</a> and <a href="http://link.springer.com/chapter/10.1007%2F978-3-319-08311-7_6">[2]</a>. Other efficient architectures can be developed based on lock-free enqueue and dequeue primitives over trace sequences containing time stamped events. Synchronization primitives for dequeue operations allow different readers to progress synchronously over instantiated buffers.</p>
<p>RTEMLib solves the lock-free producer-consumer problem for ring buffer-based FIFO queues where readers are consumers and writers are producers.</p>
<h1><a class="anchor" id="usagerteml"></a>
Usage of RTEMLib </h1>
<h2><a class="anchor" id="istantiating"></a>
Instantiating buffers </h2>
<p>Buffers are resources shared among the system under observation (SUO) and monitors. They contain time-stamped event sequences to inform monitors of the SUO state changes. RTEMLib requires at least one global buffer available for the instrumentation of the system, and the linking step shall provide the address of the buffer for external monitors knowing it. We define the "interface.h" as the interface header to be used by both tasks (SUO and monitors).</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;RTEML_buffer.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> __start_periodic_monitors();</div>
<div class="line"></div>
<div class="line"><span class="comment">// defining one buffer with size 100 of type uint8_t</span></div>
<div class="line"><span class="keyword">extern</span> RTEML_buffer&lt;uint8_t, 100&gt; __buffer_monitor_set1;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define EV_C 3</span></div>
<div class="line"><span class="preprocessor">#define EV_A 4</span></div>
<div class="line"><span class="preprocessor">#define EV_set_off 5</span></div>
<div class="line"><span class="preprocessor">#define EV_B 1</span></div>
</div><!-- fragment --><p> Note that uint8_t could be used to represent events from 0 to 255 only. Other types such as uint16_t and uint32_t are available as well. Strings and classes are discouraged by us to be part of events. We encourage the programmers to map these events in one hash table to save memory usage.</p>
<p>The instantiation of buffers and monitors together shall be something like the code next. Note that is not mandatory to instantiate the buffer with the monitors, indicating that buffers could be instantiated with the SUO. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;M_morecomplex.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;M_simple.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;RTEML_buffer.h&quot;</span></div>
<div class="line"></div>
<div class="line">RTEML_buffer&lt;uint8_t, 100&gt; __buffer_monitor_set1;</div>
<div class="line"></div>
<div class="line">M_morecomplex mon_m_morecomplex(__buffer_monitor_set1, 500000);</div>
<div class="line">M_simple mon_m_simple(__buffer_monitor_set1, 1000000);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> __start_periodic_monitors()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (mon_m_morecomplex.enable()) {::printf(<span class="stringliteral">&quot;ERROR\n&quot;</span>);}</div>
<div class="line">  <span class="keywordflow">if</span> (mon_m_simple.enable()) {::printf(<span class="stringliteral">&quot;ERROR\n&quot;</span>);}</div>
<div class="line">}</div>
</div><!-- fragment --><p> <code>M_simple.h</code> header defines a monitor according to the section 'Developing a simple monitor' as defined below. <code>M_morecomplex.h</code> header defines another monitor that shares the buffer <code>__buffer_monitor_set1</code>. <code>__start_periodic_monitors</code> is a proceeder to initialize both monitors when is required by the monitoring thread.</p>
<h2><a class="anchor" id="smonitor"></a>
Developing a simple Monitor </h2>
<p>Lets construct a simple monitor based on RTEML_monitor class. First, RTEML_monitor class enables monitors to execute at a certain periodicity. The class is initialized using some arguments such as the period, the scheduler policy, and the priority. The scheduler policies and priorities are commonly OS dependent. For instance, in Windows Embedded 10 x86, we only have available the SCHED_FIFO policy in pthreads-win32, and priorities can be negative ranging from -15(lowest) to 15(highest). Zero is the normal priority.</p>
<p>For fully Posix compliant OS, the priorities are non negative and several policies such as SCHED_RR (round robin) and SCHED_OTHER exist. In case of NuttX OS, we have the same policies. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;interface.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>M_simple : <span class="keyword">public</span> RTEML_monitor {</div>
<div class="line"></div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    RTEML_reader&lt;int&gt; __reader = RTEML_reader&lt;int&gt;(__buffer_monitor_set1.getBuffer());</div>
<div class="line"></div>
<div class="line">  <span class="keyword">protected</span>:</div>
<div class="line">    <span class="keywordtype">void</span> run(){</div>
<div class="line">      ::printf(<span class="stringliteral">&quot;Body of the monitor.&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    M_simple(useconds_t p): RTEML_monitor(p,SCHED_FIFO,5) {}</div>
<div class="line"></div>
<div class="line">};</div>
</div><!-- fragment --><p> This monitor will display the string <em>Body of the monitor.</em> several times with a period of <code>p</code> useconds. Lets replace the <code>run</code> proceeder with a consumer procedure as exemplified in section 'Consumer procedure' below.</p>
<h3><a class="anchor" id="consumerp"></a>
Consumer procedure</h3>
<p>The consumer process is exemplified using one lambda function that returns a pointer of type <code>void *</code> and receives an argument of type <code>void *</code>. It fits the required interface defined in RTEML_monitor for the procedure <code>run</code>. The body of the function initializes an object of type <code>RTEML_reader&lt;int&gt;</code> that will be used as the consumer for the lock-free buffer. The procedure <code>dequeue()</code> peek a tuple containing an event of type <code><a class="el" href="class_event.html">Event</a>&lt;int&gt;</code>, where the template typename is the type of the expected identifier of the event, and a time-stamp. Note that the dequeue is local to the reader, does not affect the global buffer, and can be synchronized using a certain time-stamp. However, to get a global dequeue of a certain event, we shall share the same reader among the tasks.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> consumer = [](<span class="keywordtype">void</span> *) -&gt; <span class="keywordtype">void</span>*</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> RTEML_reader&lt;int&gt; __reader = RTEML_reader&lt;int&gt;(__buffer_monitor_set1.getBuffer());</div>
<div class="line">    <a class="code" href="class_event.html">Event&lt;int&gt;</a> tmpEvent;</div>
<div class="line"></div>
<div class="line">    std::pair&lt;state_rd_t,Event&lt;int&gt; &amp;&gt; rd_tuple = __reader.dequeue();</div>
<div class="line">    tmpEvent = rd_tuple.second;</div>
<div class="line">    ::printf(<span class="stringliteral">&quot;event_out: %lu, %d code: %d\n&quot;</span>, tmpEvent.getTime(), tmpEvent.getData(), rd_tuple.first);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The variable <code>tmpEvent</code> stores the dequeued event, where the methods <code>getTime()</code> and <code>getData()</code> return the time-stamp and the event identifier, respectively.</p>
<p>See <a class="el" href="md_doc_other.html">the class diagram</a> for more information.</p>
<h2><a class="anchor" id="producerp"></a>
Producer procedure for Monitors</h2>
<p>Lets construct a producer for the lock-free ring buffers. First, we initialize the object <code>__writer</code> of the type <code>RTEML_writer&lt;int&gt;</code>. Then, we enqueue a value of type <code>int</code> to the buffer that accepts events of the type <code><a class="el" href="class_event.html">Event</a>&lt;int&gt;</code>, and finally print the buffer to the stdout for debugging purposes.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> producer = [](<span class="keywordtype">void</span> *) -&gt; <span class="keywordtype">void</span>*</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> RTEML_writer&lt;int&gt; __writer = RTEML_writer&lt;int&gt;(__buffer_monitor_set1.getBuffer());</div>
<div class="line"></div>
<div class="line">    __writer.enqueue(1);</div>
<div class="line"></div>
<div class="line">    __buffer_monitor_set1.debug();</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a class="code" href="structtask.html">__task</a> producer_A = <a class="code" href="task__compat_8h.html#a77d369d51da0f71b0d50be2ea67cab4a">__task</a>(producer, 0, SCHED_FIFO, 100000);</div>
</div><!-- fragment --><p>Note that <code>__task</code> is an helper used to construct the data descriptor of one task. It inputs the function pointer, the priority, the scheduler policy, and the period. <code>100000</code> means 1/10 seconds.</p>
<p>See <a class="el" href="md_doc_task_helpers.html">task helpers</a> for more details.</p>
<p>See how <a class="el" href="md_doc_lock_free.html">lock-free ring buffer</a> is implemented in detail. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
